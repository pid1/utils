# ╔══════════════════════════════════════════════════════════════╗
# ║  tmux.conf — right-click-driven, minimal-memorization      ║
# ║                                                             ║
# ║  MOUSE (no keyboard needed):                                ║
# ║    Right-click       → Context menu (splits, windows, etc.) ║
# ║    Click pane        → Switch to pane                       ║
# ║    Click window name → Switch to window                     ║
# ║    Drag pane border  → Resize pane                          ║
# ║    Scroll wheel      → Scroll history                       ║
# ║    Click + drag      → Select text (copies on release)      ║
# ║    Middle-click      → Paste                                ║
# ║    Hold Shift + any  → Bypass tmux, use Alacritty natively  ║
# ║                                                             ║
# ║  KEYBOARD (only when your hands are there already):         ║
# ║    Ctrl-a, then:                                            ║
# ║      |  split right        -  split down                    ║
# ║      z  zoom toggle        r  reload config                 ║
# ╚══════════════════════════════════════════════════════════════╝

# ─── Prefix ──────────────────────────────────────────────────
# Ctrl-a is easier to reach than the default Ctrl-b
set  -g prefix C-a
unbind C-b
bind C-a send-prefix

# ─── Sensible Defaults ──────────────────────────────────────
set  -g mouse on                   # Full mouse support
set  -g base-index 1               # Windows start at 1, not 0
setw -g pane-base-index 1          # Panes too
set  -g renumber-windows on        # Re-number when a window closes
set  -g history-limit 50000        # Generous scrollback
set  -g escape-time 0              # No delay after Escape (important for vim/neovim)
set  -g focus-events on            # Pass focus events to apps
set  -g set-clipboard on           # OSC 52 clipboard (system clipboard integration)
set  -g detach-on-destroy off      # Switch to another session instead of detaching
set  -g default-terminal "tmux-256color"
set -as terminal-overrides ",alacritty*:Tc"   # True color for Alacritty

# ─── Right-Click Menus (the whole point) ─────────────────────

# Right-click on a PANE → main context menu
bind -n MouseDown3Pane display-menu -T "#[align=centre]  tmux " -x M -y M \
    "New Pane Right"     r "split-window -h  -c '#{pane_current_path}'" \
    "New Pane Below"     b "split-window -v  -c '#{pane_current_path}'" \
    "" "" "" \
    "New Window"         w "new-window      -c '#{pane_current_path}'" \
    "" "" "" \
    "#{?window_zoomed_flag,Unzoom,Zoom} Pane" z "resize-pane -Z" \
    "Swap Pane Up"       u "swap-pane -U" \
    "Swap Pane Down"     d "swap-pane -D" \
    "" "" "" \
    "Rename Window"      n "command-prompt -I '#W' 'rename-window -- \"%%\"'" \
    "Copy Mode"          c "copy-mode" \
    "" "" "" \
    "Close Pane"         x "confirm-before -p 'Kill pane? (y/n)' kill-pane" \
    "Close Window"       X "confirm-before -p 'Kill window #W? (y/n)' kill-window" \
    "" "" "" \
    "Detach"             q "detach-client"

# Right-click on a WINDOW in the status bar → window menu
bind -n MouseDown3Status display-menu -T "#[align=centre]  window " -x W -y S \
    "New Window"         w "new-window   -c '#{pane_current_path}'" \
    "Rename"             n "command-prompt -I '#W' 'rename-window -- \"%%\"'" \
    "" "" "" \
    "Move Left"          h "swap-window -t -1\\; previous-window" \
    "Move Right"         l "swap-window -t +1\\; next-window" \
    "" "" "" \
    "Close"              x "confirm-before -p 'Kill window #W? (y/n)' kill-window"

# Right-click on the SESSION name (left side of status bar) → session menu
bind -n MouseDown3StatusLeft display-menu -T "#[align=centre]  session " -x M -y S \
    "New Session"        n "command-prompt 'new-session -s \"%%\"'" \
    "Switch Session"     s "choose-tree -Zs" \
    "Rename"             r "command-prompt -I '#S' 'rename-session -- \"%%\"'" \
    "" "" "" \
    "Detach"             d "detach-client" \
    "Kill"               x "confirm-before -p 'Kill session #S? (y/n)' kill-session"

# ─── Minimal Keyboard Shortcuts ──────────────────────────────
# These exist for speed, but the right-click menu does the same things.

# Splits that match the visual direction of the divider
bind  |  split-window -h  -c "#{pane_current_path}"
bind  -  split-window -v  -c "#{pane_current_path}"

# Navigate panes with arrow keys (or just click them)
bind Up    select-pane -U
bind Down  select-pane -D
bind Left  select-pane -L
bind Right select-pane -R

# Zoom toggle
bind z resize-pane -Z

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# ─── Copy Mode (vi keys) ─────────────────────────────────────
# Enter copy mode: right-click → Copy Mode, or scroll up, or prefix + [
setw -g mode-keys vi
bind -T copy-mode-vi v   send -X begin-selection
bind -T copy-mode-vi y   send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi C-v send -X rectangle-toggle    # Block selection

# ─── Status Bar ───────────────────────────────────────────────
# Clean and minimal. Adapts to light/dark terminal themes.
set  -g status-position bottom       # Change to "top" if you prefer a tab-bar feel
set  -g status-style "bg=default,fg=default"
set  -g status-left " #[bold]#S#[nobold]  "
set  -g status-right "  %H:%M "
set  -g status-left-length 24
set  -g status-right-length 16

# Window labels
set  -g window-status-format         "  #I:#W  "
set  -g window-status-current-format "#[bold,underscore]  #I:#W  #[nounderscore,nobold]"
set  -g window-status-separator      ""

# ─── Pane Borders ─────────────────────────────────────────────
set  -g pane-border-style        "fg=brightblack"
set  -g pane-active-border-style "fg=blue"
set  -g pane-border-lines single

# ─── Messages & Menus ────────────────────────────────────────
set  -g message-style "bg=default,fg=default,bold"
set  -g mode-style    "bg=blue,fg=white"
set  -g menu-style    "bg=default,fg=default"
set  -g menu-selected-style "bg=blue,fg=white"
